{% load static %}
<!DOCTYPE html>
<html>
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
        <title>Modificar usuario</title>
        <link rel="stylesheet" href="{% static 'registrar.css' %}">
        <link rel="stylesheet" href="{% static 'cuadro_mensaje.css' %}">
        <link rel="shortcut icon" href="{% static 'logo.png' %}">
        <link rel="stylesheet" href="{% static 'check.css' %}">
        <script src="https://code.jquery.com/jquery-3.4.1.js"></script>
        <script defer src="{% static 'check.js' %}"></script>
        <script>
            $(document).ready(function () {
                $("#test").CreateMultiCheckBox({ width: '260px',
                    defaultText : 'Selecciona el/los rol/es', height:'100px'});
            });
        </script>
    </head>
    <section class="form-home" style="height: 500px;">
        <h5>Modificar usuario</h5>
        <form id="buscar_usuario" action="obtener_usuario" method="GET" autocomplete="off">
            <input class="input_txt" type="text" name="username" id="username" value="" placeholder="Escriba aquí el username" maxlength="15" required>
            <input class="buttons" type="submit" name="" value="BUSCAR">
        </form>
        <h4>1) Datos Personales</h4>
        <form method="GET" autocomplete="off">
            <input class="input_txt" type="text" id="1st_name" placeholder="Primer nombre" maxlength="50" disabled required>
            <input class="input_txt" type="text" id="2nd_name" placeholder="Segundo nombre" maxlength="50" disabled>
            <input class="input_txt" type="text" id="1er_ape" placeholder="Primer apellido" maxlength="50" disabled required>
            <input class="input_txt" type="text" id="2do_ape" placeholder="Segundo apellido" maxlength="50" disabled>
            <label class="input_txt" style="color:black; height: 37.5px;">Fecha de nacimiento:</label>
            <input class="input_txt" type="date" id="fec" disabled required>
        </form>
        <h4 style="margin-top: 30%;">2) Datos del Usuario</h4>
        <form method="GET" autocomplete="off">
            <input class="input_txt" type="email" id="email" placeholder="Correo Electrónico" maxlength="100" disabled required>
            <input class="input_txt" type="password" id="pass" placeholder="Nueva constraseña" maxlength="15" disabled required>
        </form>
        <label class="input_txt" style="color:black; height: 37.5px;">Rol/es del usuario:</label>
        <select id="test">
            {% for rol in lista_roles %}
                <option selected="false" value={{ rol.0 }}>{{ rol.1 }}</option> 
            {% endfor %}
        </select>

        <input class="buttons" style="float: left; margin-top: 16.2px;" type="button" onclick="window.location='/seguridad';" name="" value="CANCELAR">
        <input class="buttons" style="float: right;"type="submit" name="" value="MODIFICAR">
    </section>
    <body>
        <!-- CUADRO DE ERROR CON MENSAJE-->
        <div class="fondo_transparente" id = "fondo">
            <div class="modal">
                <div class="modal_titulo">
                    {{ titulo }}<br>
                </div>

                <div class="modal_mensaje">
                    {% for error in errors %}
                        {% if forloop.first %}
                            <br>{{ error }}
                        {% else %}
                            <br><br>{{ error }}
                        {% endif %}
                    {% endfor %}
                </div>
                <!-- TODO -->
                <div class="modal_botones" >
                    <a href="/user_settings" class="boton">VOLVER A INTENTARLO</a>
                </div>
            </div>
        </div> 
        
        {% if errors|length > 0 %}
            <script type="text/javascript">
                setTimeout("mostrarError()", 0);
            </script>
        {% endif %}

        <script>
            function mostrarError(){
                var estilo = document.getElementById("fondo");
                estilo.style.display="block";
            }
        </script>
        <script>
            $(document).ready(function(){
                $("#buscar_usuario").submit(function(e){
                    e.preventDefault();

                    $.ajax({
                        type: 'GET',
                        url: "/obtener_usuario/",
                        data: $(this).serialize(),
                        success:function(data) {
                            document.getElementById("1st_name").disabled = false;
                            document.getElementById("1st_name").value = data.p_nombre
                            document.getElementById("2nd_name").disabled = false;
                            document.getElementById("2nd_name").value = data.s_nombre;
                            document.getElementById("1er_ape").disabled = false;
                            document.getElementById("1er_ape").value = data.p_apellido;
                            document.getElementById("2do_ape").disabled = false;
                            document.getElementById("2do_ape").value = data.s_apellido;
                            document.getElementById("fec").disabled = false;
                            document.getElementById("fec").value = data.nacimiento;
                            document.getElementById("email").disabled = false;
                            document.getElementById("email").value = data.correo;
                            document.getElementById("pass").disabled = false;
                            document.getElementById("pass").value = data.pass;
                        },
                        error: function(xhr, status, error) {
                            window.alert("NO EXISTE EL USUARIO");
                            window.location.reload();
                        }
                    });
                });
            });

        </script>
    </body>
</html>